<?xml version="1.0"?>

<a-scene>
  <a-entity position="0 0 -10">
    <script><![CDATA[
      print "starting up..."

      print("We are a <" .. Element:nodeName() .. " />")

      local parent = Element:parentNode()

      print("Our parent is a <" .. parent:nodeName() .. " />")

      local t = 0

      local children = parent:childNodes()

      local colors = { '#f0a', '#0af', '#0fa' }

      function tick (delta)
        t = t + (delta / 1000)

        -- Cycle at 0.25hz
        local i = t * 3.14 * 0.25
        local offset = 1

        for index, node in ipairs(children) do 
          i = i + 0.4

          local x = math.sin(i) * 4
          local y = math.cos(i * 3 / 2) * 2 + 2
          local z = math.cos(i / 5) * 0.5

          if node:nodeName() == 'a-box' then
            node:setAttribute("position", string.format("%.2f %.2f %.2f", x, y, z))
            node:setAttribute("color", colors[offset])

            offset = offset + 1
          end
        end

      end

      -- tick()
    ]]></script>
    <a-box position="1 2 0"></a-box>
    <a-box position="3 2 0"></a-box>
    <a-box position="6 2 0"></a-box>
  </a-entity>
</a-scene>
